# Linux iptables Router Configuration  
# Advanced Network Segmentation Rules

# Network Segments:
# DMZ Network:        172.20.1.0/24 (Webserver)
# Internal Network:   172.20.2.0/24 (Database) 
# Office Network:     172.20.3.0/24 (Office Tools)
# Management Network: 172.20.4.0/24 (Admin Access + WireGuard VPN)

[INTERFACES]
DMZ_INTERFACE=172.20.1.1/24
DATABASE_SERVER_INTERFACE=172.20.2.1/24
OFFICE_INTERFACE=172.20.3.1/24
MANAGEMENT_INTERFACE=172.20.4.1/24
WIREGUARD_INTERFACE=wg0:172.20.4.1/24
EXTERNAL_INTERFACE=eth0


[IPTABLES_RULES]

# Toestaan van HTTPS naar de firewall zelf, alleen vanaf management-subnet/VPN
iptables -A INPUT -i wg0 -p tcp --dport 443 -s 172.20.4.0/24 -j ACCEPT
iptables -A INPUT -i mgmt0 -p tcp --dport 443 -s 172.20.4.0/24 -j ACCEPT

# Alles anders naar poort 443 (de firewall zelf) blokkeren + loggen
iptables -A INPUT -p tcp --dport 443 -j LOG --log-prefix "FW-UI-BLOCK " --log-level 4
iptables -A INPUT -p tcp --dport 443 -j DROP


# # Security features
# ANTI_SPOOFING=enabled
# CONNECTION_TRACKING=enabled
# RATE_LIMITING_SSH=4_connections_per_60_seconds
# PORT_SCAN_PROTECTION=enabled


[NAT_RULES] 
# DNAT (Destination NAT) for port forwarding




[LOGGING]
LOG_LEVEL=INFO
LOG_BLOCKED_CONNECTIONS=true
LOG_ALLOWED_CONNECTIONS=false
LOG_PREFIX_BLOCKED=IPTABLES-BLOCKED
LOG_PREFIX_SSH_BRUTE=SSH-BRUTE-FORCE
LOG_RATE_LIMIT=5_per_minute
SYSLOG_FACILITY=local0

[PERSISTENCE]  
IPTABLES_SAVE_FILE=/etc/iptables/rules.v4
IP6TABLES_SAVE_FILE=/etc/iptables/rules.v6
AUTO_RESTORE_ON_BOOT=true

[MONITORING]
CONNECTION_TRACKING_FILE=/proc/sys/net/netfilter/nf_conntrack_count
CONNECTION_TRACKING_MAX=/proc/sys/net/netfilter/nf_conntrack_max
ENABLE_PERFORMANCE_MONITORING=true

[WIREGUARD_VPN]
VPN_SUBNET=172.20.4.0/24
VPN_SERVER_IP=172.20.4.1
VPN_PORT=51820
VPN_DNS=8.8.8.8,8.8.4.4
VPN_KEEPALIVE=25

# VPN Access Rules
VPN_ACCESS_DMZ=enabled
VPN_ACCESS_INTERNAL=enabled  
VPN_ACCESS_OFFICE=enabled
VPN_ACCESS_MANAGEMENT=enabled
